<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><title>配置并使用SSH密匙对自动登录服务器</title><meta name="author" content="LazyZhu"/><meta name="keywords" content="linux,ssh,putty,xshell,automate"/><meta name="description" content="文章介绍了Linux服务器SSH密匙的配置步骤以及Putty，Xshell等Windows下的SSH客户端如何使用SSH密匙来安全免密码地登录服务器。"/><link rel="stylesheet" type="text/css" href="/assets/css/main.css"/><link rel="stylesheet" type="text/css" href="/assets/css/pygments.css"/></head><body><div class="container"><div class="header"><div id="siteName"> L<u>azy</u>Z<u>hu's</u> H<u>ome</u> <b><font color="red">★The Diaoyu Islands belong to China!★</font></b></div><ul class="menu main"><li class="menu_item"> <a href="/">Home</a></li><li class="menu_item"> <a href="/projects.html">Projects</a></li><li class="menu_item"> <a href="/wiki.html">Wiki</a></li><li class="menu_item"> <a href="/about.html">About</a></li></ul></div><div class="sidebar"><div><center><form id="cse" id="searchbox_005189583365303993202:tnnrmg1lhbi" action="/SearchResults.html"> <input value="005189583365303993202:dwmyxdrq_ny" name="cx" type="hidden"/> <input value="FORID:11" name="cof" type="hidden"/> <input id="q" style="width:110px" name="q" size="75" /> <input value="Search" name="sa" type="submit"/></form></center><h4>分类</h4><ul><li> <a href="/categories.html#Linux"> <b><font color="blue">Linux</font></b> </a> <sup>[3]</sup></li><li> <a href="/categories.html#Nginx"> Nginx </a> <sup>[3]</sup></li><li> <a href="/categories.html#Life"> Life </a> <sup>[1]</sup></li></ul><hr/><h4>标签</h4><ul><li> <a href="/tags.html#script"> script </a> <sup>[2]</sup></li><li> <a href="/tags.html#compile"> compile </a> <sup>[2]</sup></li><li> <a href="/tags.html#xshell"> <b><font color="blue">xshell</font></b> </a> <sup>[2]</sup></li><li> <a href="/tags.html#publickey"> publickey </a> <sup>[1]</sup></li><li> <a href="/tags.html#linux"> <b><font color="blue">linux</font></b> </a> <sup>[3]</sup></li><li> <a href="/tags.html#blog"> blog </a> <sup>[1]</sup></li><li> <a href="/tags.html#module"> module </a> <sup>[2]</sup></li><li> <a href="/tags.html#centos"> centos </a> <sup>[1]</sup></li><li> <a href="/tags.html#windows"> windows </a> <sup>[1]</sup></li><li> <a href="/tags.html#nginx"> nginx </a> <sup>[3]</sup></li><li> <a href="/tags.html#memcached"> memcached </a> <sup>[1]</sup></li><li> <a href="/tags.html#static"> static </a> <sup>[1]</sup></li><li> <a href="/tags.html#shell"> shell </a> <sup>[1]</sup></li><li> <a href="/tags.html#ssh"> <b><font color="blue">ssh</font></b> </a> <sup>[1]</sup></li><li> <a href="/tags.html#gzip"> gzip </a> <sup>[1]</sup></li><li> <a href="/tags.html#redis"> redis </a> <sup>[1]</sup></li><li> <a href="/tags.html#lnmp"> lnmp </a> <sup>[2]</sup></li><li> <a href="/tags.html#automate"> <b><font color="blue">automate</font></b> </a> <sup>[2]</sup></li><li> <a href="/tags.html#putty"> <b><font color="blue">putty</font></b> </a> <sup>[2]</sup></li><li> <a href="/tags.html#kickstart"> kickstart </a> <sup>[1]</sup></li><li> <a href="/tags.html#life"> life </a> <sup>[1]</sup></li></ul><hr/><h4>归档</h4><ul><li><b><font color="blue"><a href="/archive.html#2012">2012</a></font></b></li></ul></div></div><div class="content"><div class="tags"> 分类: /<a class="category" href="/categories.html#Linux">Linux</a>/ - 标签: <span class="tag"><a href="/tags.html#linux">linux</a></span> <span class="tag"><a href="/tags.html#ssh">ssh</a></span> <span class="tag"><a href="/tags.html#putty">putty</a></span> <span class="tag"><a href="/tags.html#xshell">xshell</a></span> <span class="tag"><a href="/tags.html#automate">automate</a></span> - 日期: 2012.09.15</div><br/><h1>配置并使用SSH密匙对自动登录服务器</h1><p>前面提到过如何生成SSH密匙对，如果还不会，请阅读<a href="http://lazyzhu.com/Linux/Multiple-ways-to-generate-ssh-public-and-private-keys.html" title="SSH密匙对生成方法汇总">SSH密匙对生成方法汇总</a>。现在已经有了密匙对，<code>id_rsa.pub</code>为公匙(public key)，而<code>id_rsa</code>为私匙(private key)，那么接下来讲解如何在远程Linux服务器和本地SSH客户端配置密匙对，最后可以安全自动登录Linux服务器的SSH。这种方法比传统的密码登录安全、简便，不易被破解，强烈建议各位站长使用。</p><br/><h2>1. 配置 id_rsa.pub</h2><p>Linux存放密匙的位置一般在<code>~/.ssh</code>，名称默认为<code>authorized_keys</code>，当然这些都可以自定义的。</p><p>先确认目录<code>~/.ssh</code>是否存在，不存在的话，运行：</p><div class="highlight"><pre><code class="bash">mkdir -p ~/.ssh
</code></pre></div><p>用<a href="http://winscp.net/eng/download.php" title="WinSCP">WinSCP</a>或者其他工具将<code>id_rsa.pub</code>上传至目录<code>~/.ssh</code>并改名为<code>authorized_keys</code>。</p><p>这样还不行，最后还需设置下权限：</p><div class="highlight"><pre><code class="bash">chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
</code></pre></div><br/><h2>2. 配置 sshd_config</h2><p><code>openssh</code>的配置文件位置在<code>/etc/ssh/sshd_config</code>，修改配置：</p><div class="highlight"><pre><code class="bash">vi /etc/ssh/sshd_config
</code></pre></div><p>确保<code>sshd_config</code>三个参数如下：</p><div class="highlight"><pre><code class="bash">RSAAuthentication yes <span class="c">#RSA认证</span>
PubkeyAuthentication yes <span class="c">#公匙认证</span>
AuthorizedKeysFile ~/.ssh/authorized_keys <span class="c">#公匙路径</span>
</code></pre></div><br/><h2>3.1 本地配置 Xshell</h2><p>启动<code>Xshell</code>，打开菜单栏<code>Tools</code>下的<code>User Key Manager</code>，将私匙<code>id_rsa</code>导入<code>Xshell</code>，如图：</p><p><img src="/images/2012/2012-09-15_Xshell01.png" alt="Xshell"/></p><p>然后为主机（本例中为<code>LocalHost</code>）配置私匙<code>id_rsa</code>，如图：</p><p><img src="/images/2012/2012-09-15_Xshell02.png" alt="Xshell"/></p><p>最后就可以连接主机了，第一次会有提示，按<code>Accept &amp; Save</code>即可。</p><br/><h2>3.2 本地配置 PuTTY</h2><p>前面文章提到过，PuTTY无法识别<code>id_rsa</code>，只能用puttygen转换成的<code>PuTTY.ppk</code>。</p><p>启动<code>PuTTY</code>，为主机（本例中为<code>LocalHost</code>）配置私匙<code>PuTTY.ppk</code>，如图：</p><p><img src="/images/2012/2012-09-15_PuTTY01.png" alt="PuTTY"/></p><p><img src="/images/2012/2012-09-15_PuTTY02.png" alt="PuTTY"/></p><p><img src="/images/2012/2012-09-15_PuTTY03.png" alt="PuTTY"/></p><br/><h2>4. 取消密码登录</h2><p>经上述几步设置后，应该可以成功使用密匙认证登录SSH。若失败，请检查配置是否正确。</p><p>使用密匙认证登录SSH无需手动输入密码（设置了<code>passphrase</code>的除外），会有<code>Authenticating with public key ...</code>的提示。</p><p>在确认可以成功使用密匙认证登录SSH后，为了服务器安全，一定要关闭密码登录方式。</p><p>同样需修改配置文件<code>/etc/ssh/sshd_config</code>。</p><div class="highlight"><pre><code class="bash">vi /etc/ssh/sshd_config
</code></pre></div><p>修改以下参数：</p><div class="highlight"><pre><code class="bash">PasswordAuthentication no
PermitEmptyPasswords no
</code></pre></div><br/><h2>可能感兴趣的文章：</h2><ul><li><a href="/Linux/Multiple-ways-to-generate-ssh-public-and-private-keys.html">SSH密匙对生成方法汇总</a></li><li><a href="/Linux/Automated-and-quick-install-centos-5-with-kickstart.html">使用Kickstart全自动化安装CentOS 5.x系统</a></li></ul><div class="ds-thread" data-thread-key="" data-title="" data-author-key="" data-url=""></div> <script>var duoshuoQuery={short_name:"lazyzhu"};(function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="http://static.duoshuo.com/embed.js",e.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script></div></div><div class="footer"> © 2012 <a href="/about.html">LazyZhu</a> All Rights Reserved. Powered by <a rel="Hostshare" href="http://my.hostshare.cn/cart.php">Hostshare</a> & <a rel="Github" href="http://pages.github.com">Github</a>.</div></body> <!--[if !IE]><!--> <script>(function(){function e(e){e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden")}function t(e){var t=this;this.header=e;var n=document.createElement("div");n.classList.add("header-ref"),n.classList.add(e.tagName),n.innerText=e.innerText,n.onclick=function(e){t.header.scrollIntoView()},this.el=n}function n(){if(!document.querySelector)return;var t=document.querySelectorAll(".sidebar H4");[].forEach.call(t,function(t){t.onclick=function(){e(t.nextElementSibling)}})}document.addEventListener("DOMContentLoaded",function(){n()})})()</script><!--<![endif]--></html>